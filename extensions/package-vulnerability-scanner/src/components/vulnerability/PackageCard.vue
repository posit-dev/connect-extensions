<script setup lang="ts">
import { computed } from "vue";

import PackageHeader from "./PackageHeader.vue";
import VulnerabilityDetails from "./VulnerabilityDetails.vue";
import type { Package } from "../../stores/packages";
import { type Vulnerability } from "../../stores/vulns";

const props = defineProps<{
  package: Package;
  vulnerabilities?: Vulnerability[];
  latestFixedVersion?: string | null;
}>();

const repo = computed(() =>
  props.package.language.toLowerCase() === "python" ? "pypi" : "cran",
);
</script>

<template>
  <div>
    <PackageHeader :package="package" :repo="repo" />

    <template v-if="vulnerabilities && vulnerabilities.length > 0">
      <p
        v-if="vulnerabilities.length > 1"
        class="text-sm font-medium text-gray-600 mb-3"
      >
        {{ vulnerabilities.length }} vulnerabilities found for this package
      </p>

      <div
        v-if="latestFixedVersion"
        class="bg-green-50 border-l-3 border-green-500 py-2 px-3 my-3 rounded-r-md"
      >
        <p class="m-0 text-green-700 flex items-center">
          <span class="mr-2">üõ†Ô∏è</span>
          <span
            >To fix
            {{
              vulnerabilities.length > 1
                ? "these vulnerabilities"
                : "this vulnerability"
            }}, upgrade to version
            <span class="font-semibold">{{ latestFixedVersion }}</span>
            or later.
          </span>
        </p>
      </div>

      <template
        v-for="vulnerability in vulnerabilities"
        :key="vulnerability.id"
      >
        <VulnerabilityDetails
          :id="vulnerability.id"
          class="not-last:mb-6"
          :summary="vulnerability.summary"
          :details="vulnerability.details"
          :publishDate="vulnerability.published"
          :modifiedDate="vulnerability.modified"
        />
      </template>
    </template>
  </div>
</template>
