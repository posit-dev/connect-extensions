<script setup lang="ts">
import PackageHeader from "./PackageHeader.vue";
import VulnerabilityDetails from "./VulnerabilityDetails.vue";
import type { Vulnerability } from "../../stores/vulns";
import type { Package } from "../../stores/packages";

defineProps<{
  packageInfo: Package;
  vulnerabilities: Vulnerability[];
  repo: "pypi" | "cran";
  latestFixedVersion: string | null;
}>();
</script>

<template>
  <div>
    <PackageHeader
      :packageName="packageInfo.name"
      :packageVersion="packageInfo.version"
      :repo="repo"
    />

    <p
      v-if="vulnerabilities.length > 1"
      class="text-sm font-medium text-gray-700 mb-3"
    >
      {{ vulnerabilities.length }} vulnerabilities found for this package
    </p>

    <div
      v-if="latestFixedVersion"
      class="bg-green-50 border-l-3 border-green-500 py-2 px-3 my-3 rounded-r-md"
    >
      <p class="m-0 text-[15px] text-green-700 flex items-center">
        <span class="mr-2">🛠️</span>
        <span
          >To fix
          {{
            vulnerabilities.length > 1
              ? "these vulnerabilities"
              : "this vulnerability"
          }}, upgrade to version {{ latestFixedVersion }} or later.</span
        >
      </p>
    </div>

    <template v-for="vulnerability in vulnerabilities" :key="vulnerability.id">
      <VulnerabilityDetails
        :id="vulnerability.id"
        class="not-last:mb-6"
        :summary="vulnerability.summary"
        :details="vulnerability.details"
        :publishDate="vulnerability.published"
        :modifiedDate="vulnerability.modified"
      />
    </template>
  </div>
</template>
